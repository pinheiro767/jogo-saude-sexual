<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tabuleiro Imersivo - Educação Sexual</title>
    <script src="/_sdk/element_sdk.js"></script> <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        /* Estilos Gerais */
        body {
            background: linear-gradient(135deg, #a1c4fd, #c2e9fb);
            font-family: 'Poppins', sans-serif;
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            padding: 10px;
            box-sizing: border-box;
            color: #333;
        }

        /* Container Principal do Jogo */
        .game-wrapper {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: clamp(10px, 3vw, 20px); /* Padding responsivo */
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 95vmin;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Cabeçalho, Infos Jogador, Turno */
        .game-header { text-align: center; margin-bottom: 15px; }
        .game-title { font-size: clamp(1.4rem, 4vw, 2.2rem); font-weight: 600; background: linear-gradient(135deg, #5a67d8, #8a4baf); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 5px; }
        .instructions { font-size: clamp(0.75rem, 2vw, 0.9rem); color: #4a5568; margin-bottom: 10px; }
        .players-info { display: flex; justify-content: space-around; width: 100%; max-width: 600px; margin-bottom: 15px; gap: 10px; flex-wrap: wrap; }
        .player-card { flex: 1 1 160px; background: linear-gradient(135deg, #4299e1, #3182ce); color: white; padding: 8px 12px; border-radius: 12px; text-align: center; box-shadow: 0 6px 12px rgba(0,0,0,0.1); border: 2px solid transparent; transition: all 0.3s ease; font-size: clamp(0.7rem, 1.8vw, 0.85rem); }
        .player-card.active { border-color: #ffd700; box-shadow: 0 0 15px rgba(255, 215, 0, 0.4); transform: scale(1.03); }
        .player-card.player2 { background: linear-gradient(135deg, #e53e3e, #c53030); }
        .player-name { font-size: clamp(0.8rem, 2vw, 1rem); font-weight: 600; margin-bottom: 4px; }
        .player-stats { display: flex; justify-content: space-around; margin-top: 6px; }
        .stat { display: flex; align-items: center; gap: 4px; font-size: clamp(0.8rem, 1.9vw, 0.9rem); }
        .coins { color: #ffd700; } .bombs { color: #ff9a9a; }
        .game-info { width: 100%; display: flex; justify-content: center; margin-bottom: 15px; }
        .turn-indicator { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 7px 18px; border-radius: 20px; font-size: clamp(0.85rem, 2.1vw, 1rem); font-weight: 600; box-shadow: 0 6px 12px rgba(0,0,0,0.15); text-align: center; min-width: 160px; }

        /* Container do Tabuleiro */
        .board-container {
            position: relative;
            width: 70vmin;
            height: 70vmin;
            max-width: 600px;
            max-height: 600px;
            margin-bottom: 15px;
        }
        .board { width: 100%; height: 100%; position: relative; }

        /* Estilo das Casas (Quadrado com Imagem de Fundo) */
        .square {
            width: 80px;  /* Largura original */
            height: 100px; /* Altura original */
            border: 3px solid rgba(255, 255, 255, 0.7);
            border-radius: 15px; /* Raio original */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end; /* Conteúdo em baixo */
            padding-bottom: 5px; /* Espaço para label */
            font-weight: 600;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: absolute;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            overflow: hidden;
            background-color: rgba(255, 255, 255, 0.1); /* Fallback */
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            color: #fff;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
        }

        /* Casas Especiais (Início/Fim) */
        .square.start, .square.finish {
            width: 90px; height: 110px; /* Tamanho original maior */
            justify-content: center; /* Centraliza conteúdo */
            padding-bottom: 0;
            background-image: none !important; /* Sem imagem de fundo */
            color: #333;
            text-shadow: none;
        }
        .square.start { background: linear-gradient(135deg, #e6f3ff, #bee3f8); border-color: rgba(66, 153, 225, 0.8); }
        .square.finish { background: linear-gradient(135deg, #f0e6ff, #e9d8fd); border-color: rgba(159, 122, 234, 0.8); animation: pulse-float 2s infinite, float-gentle 3s ease-in-out infinite; } /* Re-adicionada float-gentle */
        @keyframes pulse-float { 0%, 100% { box-shadow: 0 5px 15px rgba(0,0,0,0.1), 0 0 0 0 rgba(159, 122, 234, 0.7); transform: scale(1); } 50% { box-shadow: 0 5px 15px rgba(0,0,0,0.1), 0 0 0 10px rgba(159, 122, 234, 0); transform: scale(1.05); } }

        /* Elemento interno para emoji (Start/Finish) */
        .square-character {
            font-size: 2.5rem; /* Tamanho original do emoji */
            line-height: 1;
            margin-bottom: 5px;
        }

        /* Rótulo (Número ou Texto) */
        .square-number {
            font-size: 0.8rem; /* Tamanho original */
            font-weight: 600;
            color: #fff;
            background: rgba(0, 0, 0, 0.45);
            padding: 2px 6px; /* Padding original */
            border-radius: 8px; /* Raio original */
            position: relative;
            z-index: 3;
            display: inline-block;
             /* margin-top removido, usa flex-end no .square */
        }
        /* Cor diferente para label de Start/Finish */
        .square.start .square-number,
        .square.finish .square-number {
            color: #4a5568; /* Cor original */
            background: rgba(255, 255, 255, 0.85);
            margin-top: 5px; /* Espaço abaixo do emoji */
        }

        .square:hover { transform: scale(1.1) translateY(-5px); box-shadow: 0 15px 35px rgba(0,0,0,0.2); border-color: #ffd700; z-index: 5; }
        @keyframes float-gentle { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-5px); } }

        /* Card Pop-up */
        .character-card { position: absolute; top: -75px; left: 50%; transform: translateX(-50%); width: 110px; height: 125px; background: white; border-radius: 12px; box-shadow: 0 8px 20px rgba(0,0,0,0.2); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 50; border: 2px solid #4299e1; animation: cardAppear 0.4s ease-out; pointer-events: none; } .character-card.show { display: flex; } .character-card.happy { border-color: #48bb78; } .character-card.sad { border-color: #e53e3e; } @keyframes cardAppear { 0% { transform: translateX(-50%) translateY(10px) scale(0.8); opacity: 0; } 100% { transform: translateX(-50%) translateY(0) scale(1); opacity: 1; } } .character-avatar { width: 50px; height: 50px; border-radius: 50%; margin-bottom: 5px; background-size: cover; background-position: center; } .character-message { font-size: 0.7rem; font-weight: 600; text-align: center; color: #4a5568; padding: 0 5px; } .character-message.happy { color: #2f855a; } .character-message.sad { color: #c53030; }

        /* Jogadores (pinos) */
        .player { position: absolute; width: 18px; height: 18px; border-radius: 50%; border: 2px solid white; top: 5px; z-index: 10; box-shadow: 0 2px 4px rgba(0,0,0,0.4); display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: bold; color: white; transition: all 0.3s ease; } .player.player1 { background: linear-gradient(135deg, #4facfe, #00f2fe); left: 5px; } .player.player2 { background: linear-gradient(135deg, #f093fb, #f5576c); right: 5px; }

        /* Roleta */
        .roulette-container { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); display: flex; flex-direction: column; align-items: center; gap: 15px; z-index: 10; } .roulette { width: clamp(120px, 25vmin, 160px); height: clamp(120px, 25vmin, 160px); border-radius: 50%; background: conic-gradient( #ff7e7e 0deg 60deg, #7afcff 60deg 120deg, #7affd4 120deg 180deg, #ffe07a 180deg 240deg, #ff7afc 240deg 300deg, #a07aff 300deg 360deg ); border: 6px solid rgba(255, 255, 255, 0.9); box-shadow: 0 10px 25px rgba(0,0,0,0.15); cursor: pointer; transition: transform 0.3s ease; position: relative; display: flex; align-items: center; justify-content: center; } .roulette:hover { transform: scale(1.05); } .roulette.spinning { animation: spin 2.5s cubic-bezier(0.25, 1, 0.5, 1); } @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(1440deg); } } .roulette-center { width: clamp(40px, 8vmin, 50px); height: clamp(40px, 8vmin, 50px); background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: clamp(1.2rem, 3vmin, 1.8rem); font-weight: bold; color: #555; box-shadow: inset 0 3px 6px rgba(0,0,0,0.1); } .roulette-pointer { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 10px solid transparent; border-right: 10px solid transparent; border-top: 20px solid #ffcc00; filter: drop-shadow(0 2px 3px rgba(0,0,0,0.3)); }

        /* Legenda */
        .legend { display: flex; justify-content: center; gap: 15px; margin-top: 15px; flex-wrap: wrap; width: 100%; max-width: 600px; } .legend-item { display: flex; align-items: center; gap: 6px; font-size: clamp(0.7rem, 1.8vw, 0.8rem); color: #444; } .legend-color { width: 16px; height: 16px; border-radius: 4px; border: 1px solid #ccc; background-size: cover; background-position: center;}

        /* Modais */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center; } .modal-content { background: white; padding: 25px; border-radius: 15px; max-width: 90vw; width: 450px; text-align: center; box-shadow: 0 15px 30px rgba(0,0,0,0.25); } .modal h3 { color: #4a5568; margin-top: 0; margin-bottom: 15px; font-size: clamp(1.2rem, 3vw, 1.5rem); } .modal p { line-height: 1.6; margin-bottom: 20px; color: #718096; font-size: clamp(0.9rem, 2.2vw, 1rem); } .modal-buttons { display: flex; gap: 10px; justify-content: center; } .btn { padding: 10px 20px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; font-size: clamp(0.8rem, 2vw, 0.9rem); } .btn-primary { background: #4299e1; color: white; } .btn-primary:hover { background: #3182ce; transform: translateY(-2px); } .btn-secondary { background: #e2e8f0; color: #4a5568; } .btn-secondary:hover { background: #cbd5e0; transform: translateY(-2px); } .vf-buttons { display: flex; gap: 10px; justify-content: center; margin-top: 15px; } .btn-true { background: #48bb78; color: white; } .btn-true:hover { background: #38a169; } .btn-false { background: #e53e3e; color: white; } .btn-false:hover { background: #c53030; }

        /* Estilo Video Modal (CORRIGIDO - SEM !important) */
        #videoModal {
            display: flex; /* Exibe por padrão */
        }
        #videoModal .modal-content { max-width: 800px; width: 90%; padding: 0; overflow: hidden; }
        #videoModal iframe, #videoModal video { display: block; width: 100%; height: auto; max-height: 70vh; background: #000; }
        #videoModal .modal-buttons { padding: 15px; }

        /* Responsividade */
        @media (max-width: 700px) { .board-container { width: 85vmin; height: 85vmin; } .square { width: 11%; height: 13%; } .square.start, .square.finish { width: 13%; height: 15%; } .player { width: 15px; height: 15px; font-size: 0.6rem; top: 3px; left: 3px;} .player.player2 { right: 3px; } }
        @media (max-width: 600px) { .players-info { flex-direction: column; gap: 8px; } .player-card { flex-basis: auto; } .roulette-container { gap: 10px; } }

        /* Efeitos Visuais Adicionais */
        .bubbles, .explosion-overlay, .explosion-particles, .stars-celebration, .sound-waves, .dice-visual-effect, .move-trail, .coin-visual-effect, .error-visual-effect, .victory-visual-effect { /* Mantidos da versão anterior */ }
        /* ... (Cole os keyframes e estilos específicos desses efeitos aqui, se necessário) ... */

    </style>
    <style>@view-transition { navigation: auto; }</style>
    <script src="/_sdk/data_sdk.js" type="text/javascript"></script> </head>
<body>
    <audio id="bgm" src="assets/audio/bgm.mp3" loop></audio>
    <audio id="audioDice" src="assets/audio/dice_roll.ogg"></audio>
    <audio id="audioCoin" src="assets/audio/coin.wav"></audio>
    <audio id="audioError" src="assets/audio/error.mp3"></audio>
    <audio id="audioWin" src="assets/audio/win.wav"></audio>

    <div class="bubbles"> <div class="bubble"></div> <div class="bubble"></div> <div class="bubble"></div> <div class="bubble"></div> <div class="bubble"></div> <div class="bubble"></div> </div>
    <div class="explosion-overlay" id="explosionOverlay"></div>
    <div class="explosion-particles" id="explosionParticles"></div>
    <div class="stars-celebration" id="starsCelebration"></div>
    <div class="sound-waves" id="soundWaves"></div>
    <button class="music-button" id="musicButton" onclick="toggleMusic()">🎶 Ligar Música</button>

    <div class="modal" id="videoModal" style="display: flex;">
        <div class="modal-content">
            <h3 id="videoModalTitle" style="padding: 15px 15px 0;">Bem-vindo(a)!</h3>
            <video id="introVideo" controls autoplay>
                <source src="assets/video/1000007047.mp4" type="video/mp4"> Seu navegador não suporta vídeo.
            </video>
            <div class="modal-buttons">
                <button class="btn btn-primary" onclick="closeVideoModal()">Começar Jogo</button>
            </div>
        </div>
    </div>

    <div class="game-wrapper">
        <div class="game-header">
            <h1 class="game-title" id="gameTitle">Tabuleiro Imersivo</h1>
            <p class="instructions" id="instructionsText">Clique na roleta para jogar!</p>
        </div>

        <div class="players-info">
            <div class="player-card player1 active" id="player1Card">
                <div class="player-name" id="player1Name"> J1 </div>
                <div> Posição: <span id="player1Position">1</span>/40 </div>
                <div class="player-stats"> <div class="stat coins"> 🪙 <span id="player1Coins">0</span> </div> <div class="stat bombs"> 💣 <span id="player1Bombs">0</span> </div> </div>
            </div>
            <div class="player-card player2" id="player2Card">
                <div class="player-name" id="player2Name"> J2 </div>
                <div> Posição: <span id="player2Position">1</span>/40 </div>
                <div class="player-stats"> <div class="stat coins"> 🪙 <span id="player2Coins">0</span> </div> <div class="stat bombs"> 💣 <span id="player2Bombs">0</span> </div> </div>
            </div>
        </div>

        <div class="game-info">
            <div class="turn-indicator" id="turnIndicator"> Vez do J1 </div>
        </div>

        <div class="board-container">
            <div class="board" id="gameBoard">
                </div>
            <div class="roulette-container">
                <div class="roulette" id="roulette"> <div class="roulette-pointer"></div>
                    <div class="roulette-center" id="rouletteResult">🎲</div>
                </div>
            </div>
        </div>

        <div class="legend">
             <div class="legend-item"> <div class="legend-color" style="background: linear-gradient(135deg, #e6f3ff, #bee3f8);"></div><span>Início</span> </div>
             <div class="legend-item"> <div class="legend-color" style="background-image: url('assets/img/20251020_222254_0002.jpg'); border-color: rgba(72, 187, 120, 0.8);"></div><span>Pergunta</span> </div>
             <div class="legend-item"> <div class="legend-color" style="background-image: url('assets/img/20251020_222254_0001.jpg'); border-color: rgba(237, 137, 54, 0.8);"></div><span>Risco</span> </div>
             <div class="legend-item"> <div class="legend-color" style="background: linear-gradient(135deg, #f0e6ff, #e9d8fd);"></div><span>Fim</span> </div>
        </div>
    </div>

    <div class="modal" id="questionModal"> <div class="modal-content"> <h3 id="modalTitle">Pergunta</h3> <p id="modalQuestion"></p> <div id="modalButtons" class="modal-buttons"></div> </div> </div>
    <div class="modal" id="answerModal"> <div class="modal-content"> <h3 id="answerTitle">Resposta</h3> <p id="answerText"></p> <div class="modal-buttons"><button class="btn btn-primary" onclick="closeModal()">Continuar</button> </div> </div> </div>

    <script>
        const perguntasInformativas = [
            { pergunta: "V/F: O erro mais comum ao usar um preservativo masculino é não retirar o ar da ponta antes de desenrolar.", resposta_correta: "V", explicacao: "Verdadeiro. Não retirar o ar pode criar uma bolha que faz o preservativo estourar. Aperte a ponta (reservatório) antes de desenrolar." },
            { pergunta: "V/F: É seguro guardar um preservativo na carteira ou porta-luvas por muito tempo, pois o calor e atrito não o afetam.", resposta_correta: "F", explicacao: "Falso. O calor e a fricção podem danificar o látex. Guarde-o num local fresco, seco e protegido (como um bolso da mochila) e verifique sempre o prazo de validade." },
            { pergunta: "V/F: O anel externo do preservativo feminino é inserido profundamente na vagina/ânus.", resposta_correta: "F", explicacao: "Falso. O anel externo serve para manter o preservativo feminino no lugar FORA da vagina (ou ânus), cobrindo a vulva/área externa. É também usado para guiar a inserção e a remoção." },
            { pergunta: "V/F: Apenas a camisinha masculina é considerada um método contraceptivo de barreira.", resposta_correta: "F", explicacao: "Falso. O preservativo feminino e o diafragma (que precisa ser usado com espermicida) são exemplos de métodos de barreira." },
            // { pergunta: "V/F: A pílula do dia seguinte pode ser usada como método contraceptivo regular.", resposta_correta: "F", explicacao: "Falso..." } // Já está nas de Risco
            { pergunta: "V/F: O preservativo protege 100% contra todas as ISTs, incluindo HPV e Herpes.", resposta_correta: "F", explicacao: "Falso. Ele protege as áreas que cobre, mas IST como o HPV e o Herpes Genital podem ser transmitidas pelo contato com áreas da pele infectadas que não estão cobertas." },
            { pergunta: "V/F: O duche vaginal após a relação previne gravidez e IST.", resposta_correta: "F", explicacao: "Mito. O duche pode na verdade empurrar bactérias e vírus para dentro do colo do útero e desequilibra a flora vaginal, aumentando o risco de infecções." },
            { pergunta: "V/F: A pílula anticoncepcional oferece proteção contra gravidez e ISTs.", resposta_correta: "F", explicacao: "Falso. Apenas o preservativo (masculino ou feminino) oferece dupla proteção: contra a gravidez e contra a maioria das IST." },
            { pergunta: "V/F: Consentimento dado uma vez vale para toda a relação sexual, sem precisar ser reconfirmado.", resposta_correta: "F", explicacao: "Falso. Consentimento Contínuo significa que ele deve ser dado e confirmado em cada etapa, podendo ser retirado a qualquer momento. É crucial porque o consentimento anterior não garante o atual." },
            { pergunta: "V/F: Orientação Sexual e Identidade de Gênero são a mesma coisa.", resposta_correta: "F", explicacao: "Falso. Orientação Sexual é a atração por outras pessoas. Identidade de Gênero é o sentido interno de ser homem, mulher, ambos, nenhum, ou outro gênero." },
            // { pergunta: "V/F: Se não há sintomas visíveis, a pessoa definitivamente não tem uma IST.", resposta_correta: "F", explicacao: "Falso..." } // Similar à de Risco
            { pergunta: "V/F: Abrir a embalagem do preservativo com os dentes é seguro se feito rapidamente.", resposta_correta: "F", explicacao: "Falso. Rasgar com dentes ou unhas pode criar um microfuro invisível que anula a proteção. Use os dedos na borda serrilhada." },
            { pergunta: "V/F: Se colocar o preservativo do lado errado, basta virá-lo e continuar usando.", resposta_correta: "F", explicacao: "Falso. Se começou a desenrolar do lado errado e tocou no pênis, jogue fora e pegue outra! Fluidos pré-ejaculatórios podem ter contaminado a parte interna." },
            { pergunta: "V/F: Não é necessário apertar a ponta do preservativo antes de desenrolar, o ar não interfere.", resposta_correta: "F", explicacao: "Falso. Aquela pontinha é o reservatório. Se não apertar para tirar o ar, na hora da ejaculação, a pressão pode fazer o preservativo estourar." },
            { pergunta: "V/F: Não é preciso desenrolar o preservativo completamente até a base do pênis.", resposta_correta: "F", explicacao: "Falso. Sim, totalmente! A camisinha só protege se cobrir o pênis por inteiro, da cabeça até a base." },
            { pergunta: "V/F: Para retirar o preservativo masculino, espere o pênis ficar mole e puxe-o.", resposta_correta: "F", explicacao: "Falso. Retire logo após a ejaculação, antes que o pênis amoleça, segurando a borda na base para não vazar." },
            { pergunta: "V/F: O preservativo feminino só pode ser colocado imediatamente antes da relação.", resposta_correta: "F", explicacao: "Falso. Uma das vantagens é que pode ser colocado horas antes, garantindo que a prevenção já está pronta." },
            { pergunta: "V/F: O anel menor (interno) do preservativo feminino deve ficar próximo à entrada da vagina.", resposta_correta: "F", explicacao: "Falso. O anel menor é quem prende a camisinha lá dentro e deve ser empurrado o mais fundo possível." },
            { pergunta: "V/F: O anel externo do preservativo feminino não ajuda a guiar o pênis durante a penetração.", resposta_correta: "F", explicacao: "Falso. O anel externo (maior) fica para fora e funciona como um 'guia' para o pênis entrar dentro da camisinha." },
            // { pergunta: "V/F: Usar preservativo feminino e masculino ao mesmo tempo aumenta a proteção.", resposta_correta: "F", explicacao: "Falso!..." } // Já está nas de Risco
            { pergunta: "V/F: Para remover o preservativo feminino, basta puxá-lo diretamente sem torcer o anel externo.", resposta_correta: "F", explicacao: "Falso. Você deve torcer o anel externo antes de puxar para 'fechar' a bolsa e prender o sêmen lá dentro." },
            { pergunta: "V/F: Comunicação clara sobre consentimento não é essencial para uma relação sexual saudável.", resposta_correta: "F", explicacao: "Falso. A comunicação aberta e o consentimento são a base de qualquer relação sexual saudável e respeitosa." },
            { pergunta: "V/F: Libido e desejo sexual significam exatamente a mesma coisa.", resposta_correta: "F", explicacao: "Falso. Libido é o impulso sexual geral ('motor'), enquanto o desejo é a vontade específica de ter atividade sexual ('vontade de dirigir')." },
            { pergunta: "V/F: Compartilhar conteúdo íntimo (sexting) não apresenta riscos se houver confiança.", resposta_correta: "F", explicacao: "Falso. Os riscos de exposição e distribuição não consensual (pornografia de vingança) existem e podem ter graves consequências." },
            { pergunta: "V/F: Explorar fora da zona de conforto sexual não exige comunicação ou consentimento prévio.", resposta_correta: "F", explicacao: "Falso. Explorar fora dessa zona com um parceiro requer comunicação, confiança e consentimento mútuo." }
        ];

        const perguntasRisco = [
            { pergunta: "Verdade ou Mito: Esquecer a pílula anticoncepcional num dia, mas tomá-la no dia seguinte, anula completamente o risco de gravidez.", resposta_correta: "F", explicacao: "Falso. A eficácia da pílula depende da tomada correta e diária. Se você falhar um dia, a proteção pode ser reduzida, e métodos de proteção adicionais (como o preservativo) devem ser usados." },
            { pergunta: "É seguro usar dois preservativos ao mesmo tempo para maior proteção.", resposta_correta: "F", explicacao: "Falso. Usar dois preservativos aumenta o atrito entre eles, fazendo com que ambos se rasguem mais facilmente. Use sempre apenas um." },
            { pergunta: "A pílula do dia seguinte pode ser usada como método contraceptivo regular.", resposta_correta: "F", explicacao: "Falso. A pílula do dia seguinte é apenas para emergências. Usar regularmente pode causar desequilíbrios hormonais e é menos eficaz." },
            { pergunta: "É possível engravidar mesmo usando preservativo corretamente.", resposta_correta: "V", explicacao: "Verdadeiro. Nenhum método é 100% eficaz. O preservativo tem cerca de 98% de eficácia quando usado corretamente, mas ainda existe uma pequena chance de falha." },
            { pergunta: "Toda IST apresenta sintomas visíveis.", resposta_correta: "F", explicacao: "Falso. Muita IST (como Clamídia, HPV e HIV) pode ser assintomática por longos períodos. Por isso é importante fazer testes regulares." },
            { pergunta: "O preservativo protege contra toda IST.", resposta_correta: "F", explicacao: "Falso. O preservativo protege contra a maioria, mas algumas como HPV e Herpes podem ser transmitidas pelo contato com áreas da pele não cobertas." },
            { pergunta: "Lubrificantes à base de óleo são seguros para usar com preservativos de látex.", resposta_correta: "F", explicacao: "Falso. Lubrificantes à base de óleo (como vaselina) podem danificar o látex, fazendo o preservativo rasgar. Use sempre lubrificantes à base de água ou silicone." },
            { pergunta: "É possível engravidar tendo relação sexual durante a menstruação.", resposta_correta: "V", explicacao: "Verdadeiro. Embora a probabilidade seja menor, espermatozoides podem sobreviver por vários dias, e a ovulação pode ocorrer mais cedo em alguns ciclos." },
            { pergunta: "IST é um problema de saúde apenas para pessoas sexualmente ativas com múltiplos parceiros.", resposta_correta: "F", explicacao: "Falso. Qualquer pessoa sexualmente ativa pode contrair uma IST, independentemente do número de parceiros. O risco está na prática desprotegida." },
            { pergunta: "O sexo anal é uma prática de baixo risco para a transmissão de IST em comparação com o sexo vaginal.", resposta_correta: "F", explicacao: "Falso. O sexo anal é, na verdade, uma prática de alto risco para a transmissão de IST (incluindo o HIV) devido à maior fragilidade do tecido anal." }
        ];
    </script>

    <script>
        // Elementos, Mapeamento Imagens, Estado Jogo, Config (mantidos)
        const bgm = document.getElementById('bgm'); const introVideo = document.getElementById('introVideo'); const audioDice = document.getElementById('audioDice'); const audioCoin = document.getElementById('audioCoin'); const audioError = document.getElementById('audioError'); const audioWin = document.getElementById('audioWin');
        const imgPath = 'assets/img/'; const imgCasaNormal = imgPath + '20251020_222254_0002.jpg'; const imgCasaRisco = imgPath + '20251020_222254_0001.jpg'; const imgReacaoAcerto = imgPath + '20251020_222254_0003.jpg'; const imgReacaoErro = imgPath + '20251020_222253_0000.jpg';
        let gameState = { currentPlayer: 1, players: { 1: { position: 1, coins: 0, bombs: 0 }, 2: { position: 1, coins: 0, bombs: 0 } }, gameEnded: false, musicPlaying: false };
        let currentQuestion = null; let currentQuestionType = null;
        const defaultConfig = { game_title: "Tabuleiro Imersivo", player1_name: "J1", player2_name: "J2", instructions_text: "Clique na roleta!" };
        let isSpinning = false;

        // --- Funções Auxiliares (Áudio, Efeitos, Modais) ---
        function playSound(audioElement) { if (audioElement) { audioElement.currentTime = 0; audioElement.play().catch(e => console.warn("Erro ao tocar áudio:", e)); } }
        function toggleMusic() { const button = document.getElementById('musicButton'); gameState.musicPlaying = !gameState.musicPlaying; if (gameState.musicPlaying) { button.textContent = '🎵 Música Ligada'; button.classList.add('playing'); bgm?.play().catch(e => console.warn("Erro BGM:", e)); } else { button.textContent = '🎶 Ligar Música'; button.classList.remove('playing'); bgm?.pause(); } }
        function closeVideoModal() { const videoModal = document.getElementById('videoModal'); console.log("Tentando fechar vídeo..."); if(videoModal) { videoModal.style.display = 'none'; console.log("Modal display: none"); } else { console.error("videoModal não encontrado!"); } if(introVideo) { introVideo.pause(); introVideo.currentTime = 0; } if (!gameState.musicPlaying && bgm) { try { toggleMusic(); } catch(e){ console.warn("Erro ao iniciar BGM:", e)} } } // Tratamento de erro para BGM
        function createSoundWaves(element, color, count = 1) { const container = document.getElementById('soundWaves'); if (!container || !element) return; const rect = element.getBoundingClientRect(); const centerX = rect.left + rect.width / 2; const centerY = rect.top + rect.height / 2; for (let i = 0; i < count; i++) { const wave = document.createElement('div'); wave.className = 'sound-wave'; wave.style.borderColor = color; wave.style.left = (centerX - 10) + 'px'; wave.style.top = (centerY - 10) + 'px'; wave.style.animationDelay = (i * 0.3) + 's'; container.appendChild(wave); setTimeout(() => { if (container.contains(wave)) { container.removeChild(wave); } }, 1500 + (i * 300)); } }
        function createDiceVisualEffect() { playSound(audioDice); const effect = document.createElement('div'); effect.className = 'dice-visual-effect'; effect.textContent = '🎲'; document.body.appendChild(effect); setTimeout(() => { if (document.body.contains(effect)) { document.body.removeChild(effect); } }, 1000); }
        function createMoveTrail(fromElement, toElement) { if (!fromElement || !toElement) return; const fromRect = fromElement.getBoundingClientRect(); const toRect = toElement.getBoundingClientRect(); const steps = 8; const boardContainer = document.querySelector('.board-container'); if (!boardContainer) return; const containerRect = boardContainer.getBoundingClientRect(); const offsetX = containerRect.left; const offsetY = containerRect.top; // Calcula offset do container
            // Adiciona scroll atual da página para compensar
            const scrollX = window.scrollX || window.pageXOffset;
            const scrollY = window.scrollY || window.pageYOffset;

            for (let i = 0; i < steps; i++) { setTimeout(() => { const trail = document.createElement('div'); trail.className = 'move-trail'; const progress = i / (steps - 1);
            // Ajusta cálculo de X e Y para incluir scroll e offset do container
            const x = (fromRect.left + scrollX - offsetX) + (toRect.left - fromRect.left) * progress + (fromRect.width / 2) - 4; // -4 para centralizar o trail de 8px
            const y = (fromRect.top + scrollY - offsetY) + (toRect.top - fromRect.top) * progress + (fromRect.height / 2) - 4; // -4 para centralizar o trail de 8px
             trail.style.left = x + 'px'; trail.style.top = y + 'px'; boardContainer.appendChild(trail); setTimeout(() => { if (trail.parentNode) { trail.parentNode.removeChild(trail); } }, 1000); }, i * 80); } } // Diminuído tempo entre rastros
        function createCoinVisualEffect() { playSound(audioCoin); const effect = document.createElement('div'); effect.className = 'coin-visual-effect'; effect.textContent = '🪙'; document.body.appendChild(effect); setTimeout(() => { if (document.body.contains(effect)) { document.body.removeChild(effect); } }, 2000); }
        function createErrorVisualEffect() { playSound(audioError); const effect = document.createElement('div'); effect.className = 'error-visual-effect'; effect.textContent = '💥'; document.body.appendChild(effect); setTimeout(() => { if (document.body.contains(effect)) { document.body.removeChild(effect); } }, 1500); }
        function createVictoryVisualEffect() { playSound(audioWin); const effect = document.createElement('div'); effect.className = 'victory-visual-effect'; effect.textContent = '🏆'; document.body.appendChild(effect); setTimeout(() => { if (document.body.contains(effect)) { document.body.removeChild(effect); } }, 3000); }
        function createExplosion() { const overlay = document.getElementById('explosionOverlay'); const particlesContainer = document.getElementById('explosionParticles'); if(!overlay || !particlesContainer) return; overlay.style.display = 'block'; overlay.style.animation = 'none'; overlay.offsetHeight; overlay.style.animation = 'explode 1.5s ease-out'; particlesContainer.innerHTML = ''; for (let i = 0; i < 30; i++) { const particle = document.createElement('div'); particle.className = 'particle'; const angle = Math.random() * 360; const distance = 100 + Math.random() * 200; const endX = Math.cos(angle * Math.PI / 180) * distance; const endY = Math.sin(angle * Math.PI / 180) * distance; particle.style.setProperty('--end-x', `${endX}px`); particle.style.setProperty('--end-y', `${endY}px`); particle.style.background = `hsl(${Math.random() * 60}, 100%, 50%)`; particlesContainer.appendChild(particle); setTimeout(() => { if (particlesContainer.contains(particle)) { particlesContainer.removeChild(particle); } }, 1500); } setTimeout(() => { overlay.style.display = 'none'; }, 1500); document.body.classList.add('screen-shake'); setTimeout(() => { document.body.classList.remove('screen-shake'); }, 800); }
        function createStarsCelebration() { const container = document.getElementById('starsCelebration'); if(!container) return; container.innerHTML = ''; for (let i = 0; i < 20; i++) { const star = document.createElement('div'); star.className = 'dancing-star'; star.textContent = '⭐'; star.style.left = `${Math.random() * 100}%`; star.style.top = `${Math.random() * 100}%`; star.style.animationDelay = `${Math.random() * 1}s`; container.appendChild(star); setTimeout(() => { if (container.contains(star)) { container.removeChild(star); } }, 2500); } }
        function showCustomModal(title, message, buttons) { document.getElementById('answerTitle').textContent = title; document.getElementById('answerText').textContent = message; const btnContainer = document.querySelector('#answerModal .modal-buttons'); btnContainer.innerHTML = ''; buttons.forEach(button => { const btn = document.createElement('button'); btn.className = 'btn btn-primary'; btn.textContent = button.text; btn.onclick = button.action; btnContainer.appendChild(btn); }); document.getElementById('answerModal').style.display = 'flex'; }
        function closeModal() { document.getElementById('questionModal').style.display = 'none'; document.getElementById('answerModal').style.display = 'none'; const activeCard = document.querySelector('.character-card.show'); if(activeCard) activeCard.classList.remove('show'); let errorPenaltyReturn = document.getElementById('answerTitle')?.textContent.includes('RISCO') && document.getElementById('answerText')?.innerHTML.includes('Volte para o início'); if (!gameState.gameEnded && !errorPenaltyReturn) { setTimeout(() => switchPlayer(), 300); } else if (!gameState.gameEnded && errorPenaltyReturn){ isSpinning = false; /* Libera roleta após voltar */ } else { isSpinning = false; /* Libera roleta no fim */ } }

        /* ==================================================================
           initializeBoard - Quadrado com Imagem de Fundo
           ================================================================== */
        function initializeBoard() {
            const board = document.getElementById('gameBoard');
            const container = document.querySelector('.board-container');
            if (!board || !container) { console.error("Board or container not found!"); return; }
            board.innerHTML = '';

            const numSquares = 40;
            const containerSize = Math.min(container.offsetWidth, container.offsetHeight); // Usa tamanho real
            const centerX = containerSize / 2;
            const centerY = containerSize / 2;
            const radius = containerSize * 0.40; // Ajustado para não sobrepor roleta
            let baseSquareWidth = 80;
            let baseSquareHeight = 100;
             // Ajuste tamanho para telas menores se necessário (opcional)
             if (containerSize < 550) { // Ex: se container for menor que 550px
                 baseSquareWidth = containerSize * 0.11; // 11%
                 baseSquareHeight = baseSquareWidth * 1.25; // Mantém proporção
             }


            for (let i = 1; i <= numSquares; i++) {
                const square = document.createElement('div');
                square.className = 'square';
                square.id = `square-${i}`;

                const angle = ((i - 1) / numSquares) * 2 * Math.PI - Math.PI / 2;
                const x = centerX + radius * Math.cos(angle);
                const y = centerY + radius * Math.sin(angle);

                let currentWidth = baseSquareWidth;
                let currentHeight = baseSquareHeight;
                let charImageURL = null;
                let charLabel = i;
                let charEmoji = null;
                let needsCharacterElement = false;

                if (i === 1) {
                    square.classList.add('start');
                    charEmoji = '🚀'; charLabel = 'INÍCIO'; needsCharacterElement = true;
                    currentWidth = baseSquareWidth * 1.1; currentHeight = baseSquareHeight * 1.1; // Maior
                } else if (i === 40) {
                    square.classList.add('finish');
                    charEmoji = '🏆'; charLabel = 'FIM'; needsCharacterElement = true;
                    currentWidth = baseSquareWidth * 1.1; currentHeight = baseSquareHeight * 1.1; // Maior
                } else if (i % 5 === 0 || i % 7 === 0) {
                    square.classList.add('vf');
                    charImageURL = imgCasaRisco; charLabel = 'RISCO';
                } else {
                    square.classList.add('normal');
                    charImageURL = imgCasaNormal; charLabel = i;
                }

                // Define tamanho e posição
                square.style.width = `${currentWidth}px`;
                square.style.height = `${currentHeight}px`;
                square.style.left = `${x - (currentWidth / 2)}px`;
                square.style.top = `${y - (currentHeight / 2)}px`;
                square.style.animationDelay = `${i * 0.05}s`;

                // Aplica imagem de fundo
                if(charImageURL) {
                    square.style.backgroundImage = `url('${charImageURL}')`;
                }

                // Cria elemento interno para emoji (Start/Finish)
                if(needsCharacterElement) {
                    const character = document.createElement('div');
                    character.className = 'square-character';
                    character.textContent = charEmoji;
                    square.appendChild(character);
                }

                // Adiciona o rótulo
                const label = document.createElement('div');
                label.className = 'square-number';
                label.textContent = charLabel;
                square.appendChild(label);

                // Card pop-up
                if (i !== 1 && i !== 40 && charImageURL) {
                    const characterCard = document.createElement('div'); characterCard.className = 'character-card'; characterCard.id = `character-${i}`;
                    const avatar = document.createElement('div'); avatar.className = 'character-avatar has-image';
                    avatar.style.backgroundImage = `url(${charImageURL})`;
                    const message = document.createElement('div'); message.className = 'character-message'; message.textContent = '...';
                    characterCard.appendChild(avatar); characterCard.appendChild(message); square.appendChild(characterCard);
                }

                // Jogadores Iniciais
                if (i === 1) {
                    const p1 = document.createElement('div'); p1.className = 'player player1'; p1.textContent = '1'; square.appendChild(p1);
                    const p2 = document.createElement('div'); p2.className = 'player player2'; p2.textContent = '2'; square.appendChild(p2);
                }
                board.appendChild(square);
            }
        }


        // --- Funções de Lógica do Jogo ---
        function spinRoulette() {
            if (isSpinning || gameState.gameEnded) return;
            isSpinning = true;
            const rouletteElement = document.getElementById('roulette');
            const resultElement = document.getElementById('rouletteResult');
            createDiceVisualEffect();
            if(rouletteElement) rouletteElement.classList.add('spinning'); // Verifica se existe
            if(resultElement) resultElement.textContent = '🎡';
            setTimeout(() => {
                const roll = Math.floor(Math.random() * 6) + 1;
                if(resultElement) resultElement.textContent = roll;
                if(rouletteElement) rouletteElement.classList.remove('spinning');
                setTimeout(() => movePlayer(roll), 300);
            }, 2500);
        }

        function movePlayer(steps) {
             if (gameState.gameEnded) { isSpinning = false; return; }
             const player = gameState.players[gameState.currentPlayer];
             const oldPosition = player.position;
             const currentSquare = document.getElementById(`square-${oldPosition}`);
             const playerElement = currentSquare?.querySelector(`.player.player${gameState.currentPlayer}`);

             player.position = Math.min(oldPosition + steps, 40);
             const newSquare = document.getElementById(`square-${player.position}`);
             updatePlayerDisplay(); // Atualiza número ANTES

             if (playerElement && currentSquare && newSquare) {
                 createMoveTrail(currentSquare, newSquare); // Inicia rastro
                 if (playerElement.parentNode) playerElement.remove(); // Remove imediatamente
                 setTimeout(() => { // Adiciona após rastro
                     const newPlayer = document.createElement('div');
                     newPlayer.className = `player player${gameState.currentPlayer}`;
                     newPlayer.textContent = gameState.currentPlayer;
                     newPlayer.style.transform = 'scale(0)';
                     newSquare.appendChild(newPlayer);
                     newPlayer.offsetHeight;
                     newPlayer.style.transform = 'scale(1)';
                     newPlayer.style.transition = 'transform 0.3s ease-out';
                     setTimeout(() => newPlayer.classList.add('player-move-glow'), 100);
                     handleSquareAction(player.position); // Ação da casa
                 }, 700);
             } else { // Fallback
                 if (playerElement?.parentNode) playerElement.remove();
                 const newPlayer = document.createElement('div');
                 newPlayer.className = `player player${gameState.currentPlayer} player-move-glow`;
                 newPlayer.textContent = gameState.currentPlayer;
                 newSquare?.appendChild(newPlayer);
                 handleSquareAction(player.position);
             }
        }

        function handleSquareAction(position) {
            if (position === 40) {
                gameState.gameEnded = true;
                const playerName = gameState.currentPlayer === 1 ? (document.getElementById('player1Name')?.textContent || 'J1') : (document.getElementById('player2Name')?.textContent || 'J2');
                setTimeout(() => { createVictoryVisualEffect(); showWinner(playerName); }, 300);
                isSpinning = false; return;
            }
            const square = document.getElementById(`square-${position}`);
            if (!square) { console.error(`Casa ${position} não encontrada!`); switchPlayer(); return; }

            if (square.classList.contains('vf')) {
                 setTimeout(() => { showCharacterCard(position); showVFQuestion(); }, 100);
            } else if (square.classList.contains('normal')) {
                 setTimeout(() => { showCharacterCard(position); showInformativeQuestion(); }, 100);
            } else { // Start ou outra casa sem ação
                 if (!gameState.gameEnded) { setTimeout(() => switchPlayer(), 500); }
                 else { isSpinning = false; }
            }
        }

        function updatePlayerDisplay() { /* ... (mantido com verificações null) ... */ const p1 = gameState.players[1], p2 = gameState.players[2]; const p1PosEl = document.getElementById('player1Position'); if (p1PosEl) p1PosEl.textContent = p1.position; const p1CoinsEl = document.getElementById('player1Coins'); if (p1CoinsEl) p1CoinsEl.textContent = p1.coins; const p1BombsEl = document.getElementById('player1Bombs'); if (p1BombsEl) p1BombsEl.textContent = p1.bombs; const p2PosEl = document.getElementById('player2Position'); if (p2PosEl) p2PosEl.textContent = p2.position; const p2CoinsEl = document.getElementById('player2Coins'); if (p2CoinsEl) p2CoinsEl.textContent = p2.coins; const p2BombsEl = document.getElementById('player2Bombs'); if (p2BombsEl) p2BombsEl.textContent = p2.bombs; const p1Card = document.getElementById('player1Card'), p2Card = document.getElementById('player2Card'), turnInd = document.getElementById('turnIndicator'); if(!p1Card || !p2Card || !turnInd) return; if (gameState.currentPlayer === 1) { p1Card.classList.add('active'); p2Card.classList.remove('active'); turnInd.textContent = `Vez do ${document.getElementById('player1Name')?.textContent || 'J1'}`; } else { p1Card.classList.remove('active'); p2Card.classList.add('active'); turnInd.textContent = `Vez do ${document.getElementById('player2Name')?.textContent || 'J2'}`; } }
        function switchPlayer() { gameState.currentPlayer = gameState.currentPlayer === 1 ? 2 : 1; updatePlayerDisplay(); isSpinning = false; }
        function showWinner(pName) { /* ... (mantido) ... */ const winDiv = document.createElement('div'); winDiv.className = 'winner-announcement'; winDiv.innerHTML = `🎉 ${pName} VENCEU! 🎉<br>Parabéns!`; const gameInfo = document.querySelector('.game-info'); if(gameInfo) { gameInfo.innerHTML = ''; gameInfo.appendChild(winDiv); } setTimeout(() => { showCustomModal('🏆 Fim de Jogo!', `${pName} chegou primeiro!`, [ {text: 'Jogar Novamente', action: () => { gameState = { currentPlayer: 1, players: { 1: { position: 1, coins: 0, bombs: 0 }, 2: { position: 1, coins: 0, bombs: 0 } }, gameEnded: false, musicPlaying: gameState.musicPlaying }; initializeBoard(); if(gameInfo) gameInfo.innerHTML = '<div class="turn-indicator" id="turnIndicator">Vez do J1</div>'; updatePlayerDisplay(); closeModal(); isSpinning = false; }} ]); }, 2000); }
        function showInformativeQuestion() { /* ... (mantido) ... */ if (typeof perguntasInformativas === 'undefined' || perguntasInformativas.length === 0) { console.error("Erro: 'perguntasInformativas' não carregado."); closeModal(); return; } const idx = Math.floor(Math.random() * perguntasInformativas.length); currentQuestion = perguntasInformativas[idx]; currentQuestionType = 'informative'; document.getElementById('modalTitle').textContent = 'Pergunta (V/F)'; document.getElementById('modalQuestion').textContent = currentQuestion.pergunta; document.getElementById('modalButtons').innerHTML = `<div class="vf-buttons"><button class="btn btn-true" onclick="checkVFAnswer('V')">V</button><button class="btn btn-false" onclick="checkVFAnswer('F')">F</button></div>`; document.getElementById('questionModal').style.display = 'flex'; }
        function showVFQuestion() { /* ... (mantido) ... */ if (typeof perguntasRisco === 'undefined' || perguntasRisco.length === 0) { console.error("Erro: 'perguntasRisco' não carregado."); closeModal(); return; } const idx = Math.floor(Math.random() * perguntasRisco.length); currentQuestion = perguntasRisco[idx]; currentQuestionType = 'vf'; document.getElementById('modalTitle').textContent = 'PERGUNTA DE RISCO (V/F)'; document.getElementById('modalQuestion').textContent = currentQuestion.pergunta; document.getElementById('modalButtons').innerHTML = `<div class="vf-buttons"><button class="btn btn-true" onclick="checkVFAnswer('V')">V</button><button class="btn btn-false" onclick="checkVFAnswer('F')">F</button></div>`; document.getElementById('questionModal').style.display = 'flex'; }
        function showCharacterCard(position) { /* ... (mantido) ... */ const card = document.getElementById(`character-${position}`); if (card) { card.classList.add('show'); const avatar = card.querySelector('.character-avatar'); const msg = card.querySelector('.character-message'); const sq = document.getElementById(`square-${position}`); let baseImg = imgCasaNormal; if (sq?.classList.contains('vf')) { baseImg = imgCasaRisco; } if(avatar) avatar.style.backgroundImage = `url(${baseImg})`; if(msg) msg.textContent = '...'; card.classList.remove('happy', 'sad'); msg?.classList.remove('happy', 'sad'); } }
        function updateCharacterReaction(position, isCorrect) { /* ... (mantido) ... */ const card = document.getElementById(`character-${position}`); if (card) { const avatar = card.querySelector('.character-avatar'); const msg = card.querySelector('.character-message'); let imgFile; if (isCorrect) { imgFile = imgReacaoAcerto; if(msg) msg.textContent = 'Boa! 😊'; msg?.classList.add('happy'); card.classList.add('happy'); } else { imgFile = imgReacaoErro; if(msg) msg.textContent = 'Ops! 😔'; msg?.classList.add('sad'); card.classList.add('sad'); } if(avatar) { avatar.style.backgroundImage = `url(${imgFile})`; avatar.classList.add('has-image'); avatar.textContent = ''; } card.classList.add('show'); setTimeout(() => { if (card && card.classList.contains('show')) { card.classList.remove('happy', 'sad'); msg?.classList.remove('happy', 'sad'); if(msg) msg.textContent = '...'; const sq = document.getElementById(`square-${position}`); let baseImg = imgCasaNormal; if (sq?.classList.contains('vf')) { baseImg = imgCasaRisco; } if(avatar) avatar.style.backgroundImage = `url(${baseImg})`; } }, 4000); } }
        function checkVFAnswer(answer) { /* ... (mantido e ajustado) ... */ const isCorrect = answer === currentQuestion.resposta_correta; const p = gameState.players[gameState.currentPlayer]; updateCharacterReaction(p.position, isCorrect); let explanationDelay = 500; let errorPenaltyReturn = false; if (isCorrect) { p.coins++; document.getElementById('answerTitle').textContent = '✅ Correto! +1 Moeda'; setTimeout(() => { createCoinVisualEffect(); createStarsCelebration(); }, 500); } else { p.bombs++; document.getElementById('answerTitle').textContent = '❌ Incorreto! +1 Bomba'; setTimeout(() => { createErrorVisualEffect(); createExplosion(); }, 500); if (currentQuestionType === 'vf') { errorPenaltyReturn = true; document.getElementById('answerTitle').textContent = '❌ RISCO!'; document.getElementById('answerText').innerHTML = `${currentQuestion.explicacao}<br><br><strong>Volte para o início!</strong>`; explanationDelay = 2000; setTimeout(() => { const curSq = document.getElementById(`square-${p.position}`); const pEl = curSq?.querySelector(`.player.player${gameState.currentPlayer}`); if (pEl) pEl.remove(); p.position = 1; const startSq = document.getElementById('square-1'); const newP = document.createElement('div'); newP.className = `player player${gameState.currentPlayer}`; newP.textContent = gameState.currentPlayer; startSq?.appendChild(newP); updatePlayerDisplay(); closeModal(); }, 1500 + explanationDelay); } else { document.getElementById('answerText').textContent = currentQuestion.explicacao; } } if (currentQuestionType !== 'vf' || isCorrect) { document.getElementById('answerText').textContent = currentQuestion.explicacao; } updatePlayerDisplay(); document.getElementById('questionModal').style.display = 'none'; if (!errorPenaltyReturn) { setTimeout(() => { document.getElementById('answerModal').style.display = 'flex'; }, explanationDelay > 500 ? 600 : 100); } }
        // SDK Functions (Stubs)
        async function render(config) { /* ... mantido ... */ const cfg = { ...defaultConfig, ...config }; document.getElementById('gameTitle').textContent = cfg.game_title; document.getElementById('player1Name').textContent = cfg.player1_name; document.getElementById('player2Name').textContent = cfg.player2_name; document.getElementById('instructionsText').textContent = cfg.instructions_text; updatePlayerDisplay(); }
        function mapToCapabilities(config) { return {}; }
        function mapToEditPanelValues(config) { return new Map(); }

        // --- Inicialização ---
        document.addEventListener('DOMContentLoaded', function() {
            const rouletteElement = document.getElementById('roulette');
            if(rouletteElement) { rouletteElement.addEventListener('click', spinRoulette); }
            else { console.error("Elemento roleta não encontrado!"); }

            initializeBoard();
            updatePlayerDisplay();

            const videoModal = document.getElementById('videoModal');
            if (videoModal) videoModal.style.display = 'flex';
            const introVideoElement = document.getElementById('introVideo');
             if (introVideoElement) {
                 introVideoElement.play().catch(e => { console.log("Auto-play bloqueado.", e); });
             }

            if (typeof window.elementSdk !== 'undefined' && window.elementSdk) { window.elementSdk.init({ defaultConfig, render, mapToCapabilities, mapToEditPanelValues }); }
            else { render(defaultConfig); console.log("SDK não encontrado."); }

            let resizeTimeout; window.addEventListener('resize', () => { clearTimeout(resizeTimeout); resizeTimeout = setTimeout(initializeBoard, 250); });
            console.log("Caminhos Imagens:", imgCasaNormal, imgCasaRisco); // Log para debug
        });
    </script>

</body>
</html>
